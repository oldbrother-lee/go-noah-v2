# å‰ç«¯è¯­æ³•æ£€æŸ¥åˆ¤æ–­é€»è¾‘åˆ†æ

## ğŸ“‹ å½“å‰å‰ç«¯åˆ¤æ–­é€»è¾‘

### 1. è¯­æ³•æ£€æŸ¥å‡½æ•° (`syntaxCheck`)

**ä½ç½®**: `web/src/views/das/orders/commit/index.vue:287-345`

**é€»è¾‘**:
```javascript
// æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ï¼ˆerror ä¸ä¸º null æˆ– data ä¸º nullï¼‰
if (resp.error || resp.data === null || resp.data === undefined) {
  // è¯·æ±‚å¤±è´¥
  syntaxStatus.value = 1;  // æœªé€šè¿‡
  return;
}

// è¯·æ±‚æˆåŠŸï¼Œdata æ˜¯å®¡æ ¸ç»“æœæ•°ç»„
const resultData = resp.data ?? [];
syntaxRows.value = Array.isArray(resultData) ? resultData : [];
syntaxStatus.value = 0;  // é€šè¿‡ï¼
message.success('è¯­æ³•æ£€æŸ¥é€šè¿‡ï¼Œæ‚¨å¯ä»¥æäº¤å·¥å•äº†ï¼ŒO(âˆ©_âˆ©)O');
```

**é—®é¢˜**: 
- âœ… å¦‚æœè¯·æ±‚å¤±è´¥ï¼ˆHTTPé”™è¯¯ï¼‰ï¼Œæ­£ç¡®è®¾ç½®ä¸º `syntaxStatus = 1`
- âŒ å¦‚æœè¯·æ±‚æˆåŠŸï¼Œ**ç›´æ¥è®¾ç½®ä¸º `syntaxStatus = 0`**ï¼Œ**æ²¡æœ‰æ£€æŸ¥è¿”å›æ•°æ®ä¸­çš„ `level` å­—æ®µ**

### 2. æäº¤å·¥å•å‡½æ•° (`submitOrder`)

**ä½ç½®**: `web/src/views/das/orders/commit/index.vue:359-379`

**é€»è¾‘**:
```javascript
if (syntaxStatus.value !== 0) {
  message.error('è¯­æ³•æ£€æµ‹æœªé€šè¿‡ä¸å…è®¸æäº¤å·¥å•');
  return;
}
```

**é—®é¢˜**: 
- âœ… æ­£ç¡®æ£€æŸ¥ `syntaxStatus !== 0`
- âŒ ä½† `syntaxStatus` çš„è®¾ç½®é€»è¾‘æœ‰é—®é¢˜ï¼ˆè§ä¸Šé¢ï¼‰

## ğŸ” è€æœåŠ¡çš„é€»è¾‘

### åç«¯è¿”å›æ ¼å¼

**è€æœåŠ¡** (`goinsight/internal/orders/services/syntax.go:81-91`):
```go
// æ£€æŸ¥è¯­æ³•æ£€æŸ¥æ˜¯å¦é€šè¿‡
// status: 0è¡¨ç¤ºè¯­æ³•æ£€æŸ¥é€šè¿‡ï¼Œ1è¡¨ç¤ºè¯­æ³•æ£€æŸ¥ä¸é€šè¿‡
status := 0
for _, row := range returnData {
    if row.Level != "INFO" {
        status = 1
        break
    }
}
// return
return map[string]interface{}{"status": status, "data": returnData}, nil
```

**è¿”å›æ ¼å¼**:
```json
{
  "request_id": "...",
  "code": "0000",
  "data": {
    "status": 0,  // 0=é€šè¿‡, 1=ä¸é€šè¿‡
    "data": [
      {
        "level": "INFO",
        "summary": null,
        ...
      }
    ]
  },
  "message": "success"
}
```

### åˆ¤æ–­é€»è¾‘

- **status: 0** = æ‰€æœ‰SQLçš„ `Level == "INFO"` = é€šè¿‡
- **status: 1** = ä»»ä½•ä¸€æ¡SQLçš„ `Level != "INFO"` = ä¸é€šè¿‡

## ğŸ†š æ–°æœåŠ¡ vs è€æœåŠ¡

| é¡¹ç›® | è€æœåŠ¡ | æ–°æœåŠ¡ | é—®é¢˜ |
|------|--------|--------|------|
| **è¿”å›æ ¼å¼** | `{status: 0/1, data: [...]}` | `{code: 0/1, data: [...]}` | æ–°æœåŠ¡æ²¡æœ‰ `status` å­—æ®µ |
| **åˆ¤æ–­é€»è¾‘** | æ£€æŸ¥ `status` å­—æ®µ | åªæ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ | æ–°æœåŠ¡ä¸æ£€æŸ¥ `level` |
| **å‰ç«¯åˆ¤æ–­** | æ£€æŸ¥ `data.status` | æ£€æŸ¥ `syntaxStatus`ï¼ˆåªæ ¹æ®è¯·æ±‚æˆåŠŸ/å¤±è´¥ï¼‰ | å‰ç«¯é€»è¾‘ä¸å®Œæ•´ |

## âŒ å½“å‰é—®é¢˜

### é—®é¢˜1: åç«¯æ²¡æœ‰è¿”å› `status` å­—æ®µ

**æ–°æœåŠ¡è¿”å›**:
```json
{
  "code": 0,
  "message": "ok",
  "data": [
    {
      "level": "WARN",  // å³ä½¿æœ‰è­¦å‘Š
      "summary": ["è¡¨å¿…é¡»è¦æœ‰æ³¨é‡Š"],
      ...
    }
  ]
}
```

**å‰ç«¯åˆ¤æ–­**:
```javascript
// è¯·æ±‚æˆåŠŸï¼Œç›´æ¥è®¾ç½®ä¸ºé€šè¿‡
syntaxStatus.value = 0;  // âŒ é”™è¯¯ï¼å³ä½¿ level æ˜¯ WARN
```

### é—®é¢˜2: å‰ç«¯æ²¡æœ‰æ£€æŸ¥ `level` å­—æ®µ

**å½“å‰é€»è¾‘**:
- è¯·æ±‚æˆåŠŸ â†’ `syntaxStatus = 0`ï¼ˆé€šè¿‡ï¼‰
- è¯·æ±‚å¤±è´¥ â†’ `syntaxStatus = 1`ï¼ˆä¸é€šè¿‡ï¼‰

**åº”è¯¥çš„é€»è¾‘**:
- è¯·æ±‚æˆåŠŸ + æ‰€æœ‰ `level === "INFO"` â†’ `syntaxStatus = 0`ï¼ˆé€šè¿‡ï¼‰
- è¯·æ±‚æˆåŠŸ + ä»»ä½• `level !== "INFO"` â†’ `syntaxStatus = 1`ï¼ˆä¸é€šè¿‡ï¼‰
- è¯·æ±‚å¤±è´¥ â†’ `syntaxStatus = 1`ï¼ˆä¸é€šè¿‡ï¼‰

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: åç«¯è¿”å› `status` å­—æ®µï¼ˆæ¨èï¼Œä¸è€æœåŠ¡ä¸€è‡´ï¼‰

**ä¿®æ”¹åç«¯** (`go-noah/internal/handler/insight/inspect.go`):
```go
// æ£€æŸ¥å®¡æ ¸ç»“æœæ˜¯å¦æœ‰é”™è¯¯
status := 0
for _, r := range results {
    if r.Level != checker.LevelInfo {
        status = 1
        break
    }
}

api.HandleSuccess(c, gin.H{
    "status": status,  // æ·»åŠ  status å­—æ®µ
    "data": results,
})
```

**ä¿®æ”¹å‰ç«¯** (`web/src/views/das/orders/commit/index.vue`):
```javascript
// è¯·æ±‚æˆåŠŸï¼Œdata æ˜¯å®¡æ ¸ç»“æœæ•°ç»„
const resultData = resp.data ?? [];
syntaxRows.value = Array.isArray(resultData) ? resultData : [];

// æ£€æŸ¥ status å­—æ®µï¼ˆä¸è€æœåŠ¡ä¸€è‡´ï¼‰
const status = resp.data?.status ?? 1;  // é»˜è®¤ä¸é€šè¿‡
syntaxStatus.value = status;

if (status === 0) {
  message.success('è¯­æ³•æ£€æŸ¥é€šè¿‡ï¼Œæ‚¨å¯ä»¥æäº¤å·¥å•äº†ï¼ŒO(âˆ©_âˆ©)O');
} else {
  message.warning('è¯­æ³•æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·ä¿®å¤é—®é¢˜åé‡æ–°æ£€æŸ¥');
}
```

### æ–¹æ¡ˆ2: å‰ç«¯æ£€æŸ¥ `level` å­—æ®µï¼ˆä¸æ¨èï¼Œä½†å¯è¡Œï¼‰

**ä¿®æ”¹å‰ç«¯** (`web/src/views/das/orders/commit/index.vue`):
```javascript
// è¯·æ±‚æˆåŠŸï¼Œdata æ˜¯å®¡æ ¸ç»“æœæ•°ç»„
const resultData = resp.data ?? [];
syntaxRows.value = Array.isArray(resultData) ? resultData : [];

// æ£€æŸ¥æ‰€æœ‰ç»“æœçš„ level å­—æ®µï¼ˆä¸è€æœåŠ¡é€»è¾‘ä¸€è‡´ï¼‰
let status = 0;
for (const row of resultData) {
  if (row.level !== 'INFO') {
    status = 1;
    break;
  }
}
syntaxStatus.value = status;

if (status === 0) {
  message.success('è¯­æ³•æ£€æŸ¥é€šè¿‡ï¼Œæ‚¨å¯ä»¥æäº¤å·¥å•äº†ï¼ŒO(âˆ©_âˆ©)O');
} else {
  message.warning('è¯­æ³•æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·ä¿®å¤é—®é¢˜åé‡æ–°æ£€æŸ¥');
}
```

## ğŸ“Œ æ¨èæ–¹æ¡ˆ

**æ¨èä½¿ç”¨æ–¹æ¡ˆ1**ï¼Œå› ä¸ºï¼š
1. âœ… ä¸è€æœåŠ¡ä¿æŒä¸€è‡´
2. âœ… å‰ç«¯é€»è¾‘æ›´ç®€å•
3. âœ… åç«¯ç»Ÿä¸€åˆ¤æ–­é€»è¾‘ï¼Œå‰ç«¯åªéœ€æ£€æŸ¥ `status` å­—æ®µ

## ğŸ¯ ä¿®å¤æ­¥éª¤

1. **ä¿®æ”¹åç«¯**ï¼šåœ¨ `InspectSQL` å‡½æ•°ä¸­æ·»åŠ  `status` å­—æ®µ
2. **ä¿®æ”¹å‰ç«¯**ï¼šæ£€æŸ¥ `status` å­—æ®µè€Œä¸æ˜¯åªæ£€æŸ¥è¯·æ±‚æˆåŠŸ/å¤±è´¥
3. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿è¯­æ³•æ£€æŸ¥æœªé€šè¿‡æ—¶ä¸èƒ½æäº¤å·¥å•

