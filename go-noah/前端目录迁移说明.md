# 前端目录迁移说明

## 变更概述

已将 go-noah 框架的前端目录从内部 `web/` 迁移到外部 `../web/` 目录，使用项目根目录下的新版前端框架。

## 修改内容

### 1. 删除的目录
- ✅ `go-noah/web/` - 已删除旧的前端目录
- ✅ `go-noah/webbak/` - 已删除备份目录

### 2. 修改的文件

#### `internal/server/http.go`
- 修改静态文件服务路径：`./web/dist` → `../web/dist`
- 修改 NoRoute 处理路径：`web/dist/index.html` → `../web/dist/index.html`

```go
// 修改前
s.Use(static.Serve("/", static.LocalFile("./web/dist", true)))
indexPageData, err := os.ReadFile("web/dist/index.html")

// 修改后
s.Use(static.Serve("/", static.LocalFile("../web/dist", true)))
indexPageData, err := os.ReadFile("../web/dist/index.html")
```

#### `Makefile`
- 修改构建命令：从 `cd web && npm run build` 改为 `cd ../web && pnpm run build`
- 使用 `pnpm` 替代 `npm`（因为新版前端使用 pnpm）

```makefile
# 修改前
build:
	go build -ldflags="-s -w" -o ./bin/server ./cmd/server
	cd web && npm run build

# 修改后
build:
	go build -ldflags="-s -w" -o ./bin/server ./cmd/server
	cd ../web && pnpm run build
```

#### `README.md`
- 更新前端启动说明：从 `cd web` 改为 `cd ../web`
- 更新打包部署说明：使用 `pnpm` 替代 `npm`

#### `readmenew.md`
- 更新文档说明：说明前端项目位于父目录

## 目录结构

### 修改前
```
go-noah/
├── web/          # 前端目录（已删除）
├── webbak/       # 备份目录（已删除）
└── ...
```

### 修改后
```
goInsight_new/
├── go-noah/      # 后端框架
│   └── ...
└── web/          # 新版前端框架（项目根目录）
    ├── dist/      # 构建输出目录
    └── ...
```

## 使用说明

### 开发环境

1. **启动后端服务**
```bash
cd go-noah
go run cmd/server/main.go
```

2. **启动前端服务**
```bash
cd web
pnpm install
pnpm run dev
```

### 生产环境构建

1. **构建前端**
```bash
cd web
pnpm run build
```

2. **构建后端**
```bash
cd go-noah
make build
# 或者
go build -ldflags="-s -w" -o ./bin/server ./cmd/server
```

3. **运行服务**
```bash
cd go-noah
./bin/server
```

服务启动后，静态文件将从 `../web/dist` 目录提供。

## 注意事项

1. **路径依赖**：确保在 `go-noah` 目录下运行服务，因为静态文件路径是相对路径 `../web/dist`
2. **构建顺序**：先构建前端（生成 `web/dist`），再构建后端
3. **前端框架**：新版前端使用 SoybeanAdmin（Vue3 + NaiveUI），而不是原来的 AntdvPro
4. **包管理器**：新版前端使用 `pnpm`，确保已安装 pnpm

## 验证

删除完成后，可以通过以下命令验证：

```bash
# 检查 web 目录是否已删除
ls go-noah/web  # 应该提示目录不存在

# 检查外部 web 目录是否存在
ls ../web/dist  # 应该能看到构建输出
```

## 后续工作

如果需要将前端静态文件嵌入到 Go 二进制文件中，可以参考 goInsight 的做法，使用 `embed` 指令：

```go
//go:embed ../web/dist
var staticFS embed.FS
```

但目前采用外部目录的方式，便于前后端独立开发和部署。

